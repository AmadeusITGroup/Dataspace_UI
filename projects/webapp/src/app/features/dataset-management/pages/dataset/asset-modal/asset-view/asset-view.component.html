@if (asset()) {
  <div class="properties-section w-100 p-3">
    <div>
      <div class="row">
        <div class="col-6 mb-3">
          <strong>Unique ID</strong> {{ asset()['@id'] }}
          <app-copy-button
            btnClass="btn btn-sm btn-light ms-2 bg-transparent"
            [text]="asset()['@id'] || ''"
          ></app-copy-button>
        </div>

        @if (asset().properties; as properties) {
          <div class="col-6 mb-3"><strong>Name</strong> {{ properties.name || '-' }}</div>
          <div class="col-6 mb-3"><strong>Version</strong> {{ properties.version || '-' }}</div>
          <div class="col-6 mb-3">
            <strong>Description</strong> {{ properties.description || '-' }}
          </div>
          <div class="col-6 mb-3">
            <strong>Documentation</strong>
            @if (properties.documentationUrl; as documentationUrl) {
              <a class="ms-2" [href]="properties.documentationUrl">{{
                properties.documentationUrl
              }}</a>
            } @else {
              {{ properties.documentationUrl || '-' }}
            }
          </div>
          <div class="col-6 mb-3">
            <strong>Content Type</strong> {{ properties.contenttype || '-' }}
          </div>
          <div class="col-6 mb-3">
            <strong>Delivery Method</strong> {{ properties.deliveryMethod || '-' }}
          </div>
          <div class="col-6 mb-3" #collapse="ngbCollapse" [(ngbCollapse)]="isCollapsed">
            <strong>Access Type</strong> {{ properties.accessType || '-' }}
          </div>
        }
      </div>
      <!-- EXTRA INFORMATION -->

      <div class="row" #collapse="ngbCollapse" [(ngbCollapse)]="isCollapsed">
        @if (asset().properties; as properties) {
          <div class="col-6 mb-3">
            <strong>Domain Categories</strong> {{ properties.domainCategories || '-' }}
          </div>
          <div class="col-6 mb-3">
            <strong>PII constraint</strong>
            {{ properties.containsPII || '-' }}
          </div>
          <div class="col-6 mb-3">
            <strong>Payment constraint</strong>
            {{ properties.containsPaymentInfo || '-' }}
          </div>
          <div class="col-6 mb-3">
            <strong>Access level</strong> {{ properties.accessLevel || '-' }}
          </div>
          <div class="col-6 mb-3"><strong>License</strong> {{ properties.licenses || '-' }}</div>
          <div class="col-6 mb-3">
            <strong>Average Record Size</strong>
            {{ properties.averageRecordSizeBytes || '-' }}
          </div>
        }
      </div>

      <div class="d-flex justify-content-center mb-3">
        <button
          type="button"
          class="btn btn-link"
          (click)="collapse.toggle()"
          [attr.aria-expanded]="!isCollapsed"
          aria-controls="collapseExample"
        >
          @if (isCollapsed) {
            Show
          } @else {
            Hide
          }
          optional information
          <i class="bi" [ngClass]="isCollapsed ? 'bi-chevron-down ms-2' : 'bi-chevron-up ms-2'"></i>
        </button>
      </div>
    </div>

    @if (asset().properties && asset().properties.logoUrl; as logoUrl) {
      <img class="card-logo ms-3 mw-100" [src]="logoUrl" alt="dataset logo" />
    }
  </div>
  <div class="private-data-section p-3 mb-4 rounded">
    <h5 class="section-label mb-2">
      <i class="bi bi-gear me-2"></i>{{ I18N.ASSET.FIELDS.DATA_ADDRESS.TITLE }}
    </h5>
    <p [innerHTML]="I18N.ASSET.FIELDS.DATA_ADDRESS.DESCRIPTION"></p>
    <div class="data-address border-top d-flex">
      @if (asset().dataAddress; as dataAddress) {
        <div class="data-address-section w-50 p-3 border-end">
          <div class="mb-3">
            <strong class="me-2"
              >Base URL
              <i
                class="bi bi-question-circle"
                [ngbTooltip]="I18N.ASSET.FIELDS.DATA_ADDRESS.BASE_AUTH.BASE_URL"
              ></i>
            </strong>
            <a [href]="dataAddress.baseUrl" target="_blank">{{ dataAddress.baseUrl || '-' }}</a>
          </div>
          <div class="mb-3">
            <strong
              >Path
              <i
                class="bi bi-question-circle"
                [ngbTooltip]="I18N.ASSET.FIELDS.DATA_ADDRESS.BASE_AUTH.PATH"
              ></i>
            </strong>
            {{ dataAddress.path || '-' }}
          </div>
          <div class="mb-3">
            <strong
              >Query Parameters
              <i
                class="bi bi-question-circle"
                [ngbTooltip]="I18N.ASSET.FIELDS.DATA_ADDRESS.BASE_AUTH.QUERY_PARAMS"
              ></i>
            </strong>
            {{ dataAddress.queryParams || '-' }}
          </div>
          <div class="mb-3">
            <strong
              >Proxy Path
              <i
                class="bi bi-question-circle"
                [ngbTooltip]="I18N.ASSET.FIELDS.DATA_ADDRESS.BASE_AUTH.PROXY_PATH"
              ></i>
            </strong>
            {{ dataAddress.proxyPath === 'true' ? 'Enabled' : 'Disabled' }}
          </div>
          <div class="mb-3">
            <strong
              >Proxy Query Parameters
              <i
                class="bi bi-question-circle"
                [ngbTooltip]="I18N.ASSET.FIELDS.DATA_ADDRESS.BASE_AUTH.PROXY_QUERY_PARAMS"
              ></i>
            </strong>
            {{ dataAddress.proxyQueryParams === 'true' ? 'Enabled' : 'Disabled' }}
          </div>
        </div>
        <div class="authentication-section w-50 p-3">
          @if (authType) {
            <div class="mb-3"><strong>Authorization Type</strong> {{ authType }}</div>
          } @else {
            <div class="mb-3">
              {{ I18N.ASSET.FIELDS.DATA_ADDRESS.AUTHORIZATION.NO_AUTH }}
            </div>
          }

          @if (authType === 'Basic') {
            <div class="base-auth">
              <div class="mb-3">
                <strong>Authorization Key</strong> {{ dataAddress.authKey || '-' }}
              </div>
              @if (!secret()) {
                <div class="mb-3">
                  <strong>Authorization Code</strong> {{ dataAddress.authCode || '-' }}
                </div>
              }
              @if (dataAddress.secretName) {
                <div class="mb-3">
                  <strong>Secret Name</strong> {{ dataAddress.secretName || '-' }}
                </div>
              }
              <div class="mb-3">
                <ng-container
                  *ngTemplateOutlet="
                    secretDisplay;
                    context: { secret, secretLabel: 'Secret Value' }
                  "
                ></ng-container>
              </div>
            </div>
          } @else if (authType === 'OAuth2') {
            <div class="oauth2">
              <div class="mb-3">
                <strong class="me-2">Token URL</strong>
                <a [href]="dataAddress['oauth2:tokenUrl']" target="_blank">
                  {{ dataAddress['oauth2:tokenUrl'] || '-' }}</a
                >
              </div>
              <div class="mb-3">
                <strong>Client ID</strong> {{ dataAddress['oauth2:clientId'] || '-' }}
              </div>
              @if (dataAddress['oauth2:clientSecretKey']) {
                <div class="mb-3">
                  <strong>Client Secret Key</strong>
                  {{ dataAddress['oauth2:clientSecretKey'] }}
                </div>
              }
              @if (dataAddress['oauth2:privateKeyName']) {
                <div class="mb-3">
                  <strong>Private Key Name:</strong> {{ dataAddress['oauth2:privateKeyName'] }}
                </div>
              }
              <ng-container
                *ngTemplateOutlet="secretDisplay; context: { secret, secretLabel: 'Secret Value' }"
              >
              </ng-container>

              <div class="mb-3">
                <strong
                  >KID
                  <i
                    class="bi bi-question-circle"
                    [ngbTooltip]="I18N.ASSET.FIELDS.DATA_ADDRESS.OAUTH2.KID"
                  ></i
                ></strong>
                {{ dataAddress['oauth2:kid'] || '-' }}
              </div>
            </div>
          }
        </div>
      } @else {
        <div class="mb-3">No data address specified</div>
      }
    </div>
  </div>
}

<ng-template #secretDisplay let-secret="secret" let-secretLabel="secretLabel">
  <div class="mb-3">
    @if (secret() === undefined) {
      <div class="text-warning"><i class="bi bi-hourglass-split"></i> Loading secret...</div>
    } @else {
      @if (secret(); as secret) {
        <strong class="me-2">{{ secretLabel }}</strong>
        <span>{{ showMask ? '•••••••••••' : secret.value }}</span>
        <button
          type="button"
          class="btn btn-sm btn-light ms-2 bi bg-transparent"
          [ngClass]="showMask ? 'bi-eye' : 'bi-eye-slash'"
          (click)="toggleMask()"
          title="Show/hide secret"
        ></button>
        @if (secret.value) {
          <app-copy-button
            btnClass="btn btn-sm btn-light ms-2 bg-transparent"
            [text]="secret.value"
          ></app-copy-button>
        }
        <div class="text-success" title="Secret exists in the Vault">
          <i class="bi bi-lock"></i>
          Vault Protection is enabled
        </div>
      } @else {
        <div class="text-warning"><i class="bi bi-lock"></i> No Vault Protection</div>
      }
    }
  </div>
</ng-template>
